package com.vcontrol.vcontroliot;

import android.app.Activity;
import android.app.Application;
import android.content.Context;
import android.os.Handler;

import com.vcontrol.vcontroliot.log.Log;
import com.vcontrol.vcontroliot.util.CommConfig;

import java.util.LinkedList;
import java.util.List;

/**
 * Created by Vcontrol on 2016/11/11.
 */

public class VcontrolApplication extends Application {
    private static final String TAG = VcontrolApplication.class.getSimpleName();
    public static volatile Handler applicationHandler = null;

    private static Context context = null;

    /**
     * Activity列表
     */
    private List<Activity> activityList = new LinkedList<Activity>();

    /**
     * 全局唯一实例
     */
    private static VcontrolApplication instance;

    /**
     * 获取类实例对象
     *
     * @return VcontrolApplication
     */
    public static VcontrolApplication getInstance()
    {
        if (null == instance)
        {
            instance = new VcontrolApplication();
        }
        return instance;
    }

    public static Context getCurrentContext() {
        return context;
    }

    public static void setCurrentContext(Context context) {
        VcontrolApplication.context = context;
    }


    @Override
    public void onCreate()
    {
        super.onCreate();
        Log.startLogService(CommConfig.LOG_FILEPATH, CommConfig.LOG_NAME, CommConfig.LOG_MAXSIZE);
        Log.info(TAG, "init VcontrolApplication");

        applicationHandler = new Handler(this.getMainLooper());
    }


    /**
     * 保存Activity到现有列表中
     *
     * @param activity
     */
    public void addActivity(Activity activity)
    {
        activityList.add(activity);
    }

    /**
     * 关闭保存的Activity
     */
    public void exit()
    {
        if (activityList != null)
        {
            Log.debug(TAG, "exit::activityList:" + activityList.size());
            Activity activity;
            for (int i = 0; i < activityList.size(); i++)
            {
                activity = activityList.get(i);

                if (activity != null)
                {
                    if (!activity.isFinishing())
                    {
                        activity.finish();
                    }
                    activity = null;
                }
            }

            activityList.clear();
        }
    }


}
